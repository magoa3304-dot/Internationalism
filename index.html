w<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Internationalism at Mayo College</title>

<!-- PWA App Install -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#0d1117" />

<!-- Icons for iPhone -->
<link rel="apple-touch-icon" href="icon-512.png" />

<!-- Leaflet CSS -->
<link 
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@600;800&display=swap" rel="stylesheet"/>

<style>

/* =========================================================================
   GLOBAL COLORS
========================================================================= */
:root{
  --bg:#0d1117;
  --card:#161b22;
  --text:#e6edf3;
  --muted:#8b949e;
  --highlight:#f4c063;
  --border:#222;
  --max-width:1250px;

  --glass-bg: rgba(255,255,255,0.08);
  --glass-border: rgba(255,255,255,0.16);
}

*{box-sizing:border-box;}
body{
  margin:0;
  padding:0;
  background:var(--bg);
  color:var(--text);
  font-family:Inter, sans-serif;
}

/* =========================================================================
   GLASSY TOPBAR + TABS
========================================================================= */
.topbar{
  backdrop-filter: blur(18px) saturate(180%);
  -webkit-backdrop-filter: blur(18px) saturate(180%);
  background: var(--glass-bg);
  position:sticky; 
  top:0; 
  width:100%; 
  z-index:2000;
  border-bottom:1px solid var(--glass-border);
  padding:12px 18px;
  display:flex; 
  justify-content:flex-start; 
  align-items:center;
}

.tab-container{
  display:flex; 
  gap:12px; 
  overflow-x:auto; 
  scrollbar-width:none;
  padding:4px; 
  scroll-behavior:smooth; 
  position:relative;
  max-width:100%;
}
.tab-container::-webkit-scrollbar{display:none;}

.tab{
  background:var(--card);
  border:1px solid var(--border);
  padding:8px 16px;
  border-radius:30px;
  font-size:14px;
  font-weight:600;
  white-space:nowrap;
  color:var(--muted);
  cursor:pointer;
  transition:0.25s;
}
.tab:hover{
  border-color:var(--highlight);
  color:var(--highlight);
}
.tab.active{
  background:var(--highlight);
  color:black;
}

/* =========================================================================
   SEARCH BAR + FILTER BUTTON
========================================================================= */
.search-wrap{
  max-width:var(--max-width);
  margin:18px auto 0;
  padding:0 18px;
  display:flex;
  gap:12px;
  align-items:center;
}

#searchInput{
  flex:1;
  padding:12px 16px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  font-size:15px;
}

.filter-btn{
  padding:12px 18px;
  border-radius:30px;
  background:var(--glass-bg);
  border:1px solid var(--glass-border);
  backdrop-filter: blur(14px) saturate(180%);
  -webkit-backdrop-filter: blur(14px) saturate(180%);
  color:var(--text);
  cursor:pointer;
  font-weight:600;
  transition:0.25s;
}
.filter-btn:hover{
  background:rgba(255,255,255,0.14);
}

#searchMessage{
  max-width:var(--max-width);
  margin:6px auto 0;
  padding:0 18px;
  font-size:14px;
  color:#ff6b6b;
}

/* =========================================================================
   HERO
========================================================================= */
.hero{
  max-width:var(--max-width);
  margin:25px auto;
  padding:0 18px;
}
.hero h1{
  font-family:"Times New Roman";
  font-size:38px;
  color:var(--highlight);
  margin:0;
  text-shadow:
    0 0 10px rgba(244,192,99,0.7),
    0 0 18px rgba(244,192,99,0.8),
    0 0 32px rgba(244,192,99,0.9),
    0 0 48px rgba(244,192,99,1);
}
.hero p{
  margin-top:10px;
  color:var(--muted);
  font-size:16px;
}

/* =========================================================================
   MAP
========================================================================= */
.map-wrap{
  display:flex;
  justify-content:center;
  margin:12px 0;
  position:relative;
}

#map{
  width:94%;
  max-width:var(--max-width);
  height:78vh;
  border-radius:14px;
  border:2px solid var(--border);
  background:#111;
}

.reset-map{
  position:absolute;
  right:32px;
  top:12px;
  z-index:9000;
  width:38px; height:38px;
  border-radius:10px;
  background:var(--card);
  border:1px solid var(--border);
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  font-size:22px;
}
.reset-map:hover{transform:scale(1.12);}

/* =========================================================================
   EVENTS SECTION
========================================================================= */
.event-section{
  max-width:var(--max-width);
  margin:28px auto 90px;
  padding:0 18px;
}

.group{ display:none; }
.group.active{ display:block; }

.event-card{
  background: rgba(22,27,34,0.55);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.08);
  padding: 18px;
  border-radius: 14px;
  margin-bottom: 14px;
  cursor: pointer;
  transition: 0.25s ease;
  opacity:0;
  animation: fadeUp .55s forwards;
}

.event-card:hover{
  background:#1d2430;
  transform:translateY(-5px)!important;
}

.event-card h3{
  margin:0;
  color:var(--highlight);
  font-family:"Playfair Display",serif;
}
.location{
  margin-top:4px;
  font-size:13px;
  color:#58a6ff;
}

@keyframes fadeUp {
  from { opacity:0; transform:translateY(12px); }
  to   { opacity:1; transform:translateY(0); }
}

/* =========================================================================
   GALLERY (Masonry + Lightbox)
========================================================================= */
.gallery-grid {
  column-count: 3;
  column-gap: 18px;
  padding: 10px;
  margin-top: 20px;
}
@media(max-width:900px){ .gallery-grid{column-count:2;} }
@media(max-width:600px){ .gallery-grid{column-count:1;} }

.gallery-item{
  break-inside: avoid;
  margin-bottom:18px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  overflow:hidden;
  cursor:pointer;
  opacity:0;
  transform:translateY(20px);
  animation: fadeUp .6s forwards;
  transition:transform .25s, box-shadow .25s;
}
.gallery-item:hover{
  transform:scale(1.03);
  box-shadow:0 0 20px rgba(255,255,255,0.12);
}
.gallery-item img{
  width:100%;
  display:block;
}

/* Lightbox */
#lightbox{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999999;
}
#lightbox img{
  max-width:92%;
  max-height:92%;
  border-radius:12px;
  box-shadow:0 0 30px rgba(255,255,255,0.3);
}
#lightbox-close{
  position:absolute;
  top:20px; right:25px;
  font-size:42px;
  color:white;
  cursor:pointer;
}

/* =========================================================================
   HIDE MAP WHEN GALLERY OPEN
========================================================================= */
.gallery-open #map,
.gallery-open .reset-map{
  display:none !important;
}

.gallery-open #eventSection{
  max-width:100% !important;
  width:100% !important;
  padding:0 12px;
}

/* =========================================================================
   FILTER POPUP
========================================================================= */
#filterModal{
  position:fixed; inset:0; background:rgba(0,0,0,0.6);
  display:none; justify-content:center; align-items:center; z-index:5000;
}
#filterBox{
  width:92%; max-width:420px; background:var(--card);
  padding:20px; border-radius:14px; border:1px solid var(--border);
}

</style>
</head>

<body>

<!-- LIGHTBOX -->
<div id="lightbox">
  <span id="lightbox-close">✖</span>
  <img id="lightbox-img">
</div>

<!-- TOPBAR -->
<div class="topbar">
  <div class="tab-container" id="tabBar"></div>
</div>

<!-- SEARCH -->
<div class="search-wrap">
  <input id="searchInput" placeholder="Search anything… (All Categories)">
  <button class="filter-btn" id="filterBtn">Filter ▾</button>
</div>
<div id="searchMessage"></div>

<!-- HERO -->
<section class="hero">
  <h1>Internationalism at Mayo College</h1>
  <p>Through journeys that cross continents and cultures, Mayo offers its students the chance to spread their wings—discovering new skies, embracing diverse horizons, and learning to fly with a spirit that sees the world not as distant lands, but as one boundless, interconnected home.</p>
</section>

<!-- MAP -->
<div class="map-wrap">
  <div id="map"></div>
  <div class="reset-map" id="resetMap">⟳</div>
</div>

<!-- EVENTS SECTION -->
<div class="event-section" id="eventSection"></div>

<!-- FILTER POPUP -->
<div id="filterModal">
  <div id="filterBox">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0; color:var(--highlight)">Filter Categories</h3>
      <button id="closeFilter" style="
        background:none; border:none; color:var(--text);
        font-size:22px; cursor:pointer;">✖</button>
    </div>
    <div id="filterList" style="margin-top:12px;"></div>
    <div style="margin-top:15px; display:flex; gap:10px;">
      <button class="filter-btn" style="flex:1;" id="applyFilters">Apply</button>
      <button class="filter-btn" style="flex:1;" id="resetFilters">Reset</button>
    </div>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

/* ============================================================
   GALLERY IMAGES — ALL PATHS FIXED (NO "images/" ANYMORE)
============================================================ */
const DATA = {

"Gallery": [
{ img: "8bc9ba4b-d30f-4662-95b4-acb1402089fd.webp", caption:"A quiet moment where the journey felt bigger than the destination." },
{ img: "695e59fb-587a-4faf-a19b-d494c3d6ef24.jpg", caption:"Catching the world in motion — one frame, one memory at a time." },
{ img: "1d01acf0-6798-48b0-b634-5ca5aa50d0e9.JPG", caption:"A proud moment of unity — a team standing tall together." },
{ img: "6069d7a7-53ea-4eac-a9cf-9df5283d3d41.webp", caption:"The sky opened up as if celebrating our onward path." },
{ img: "exchange-img-8.jpg", caption:"A snapshot from an exchange that shaped friendships across cultures." },
{ img: "exchange-img-10.jpg", caption:"Crossing borders, collecting stories, discovering ourselves." },
{ img: "IMG_7893.JPG", caption:"A gathering of bright minds — smiles that tell a story of togetherness." },

{ img: "exchange-img-11.jpg", caption:"Where laughter became the common language of every exchange." },
{ img: "exchange-img-12.jpg", caption:"The kind of moment that makes you realise how big the world truly is." },
{ img: "fafb5f43-5339-44be-8546-2dbe3932b261.jpg", caption:"A beautiful pause in the middle of an unforgettable adventure." },
{ img: "IMG_1367.jpg", caption:"Energy, colour, and raw excitement — all captured at once." },
{ img: "IMG_4009.JPG", caption:"A moment of pride frozen in time, glowing beyond the frame." },
{ img: "img1.jpg", caption:"The beginning of a journey that promised new sights and new lessons." },
{ img: "Screenshot1.png", caption:"Behind the scenes of planning, dreaming, and building our global story." },
{ img: "Screenshot2.png", caption:"Every great journey begins with thoughtful preparation." },
{ img: "Screenshot3.png", caption:"Ideas taking shape long before the plane ever departed." },
{ img: "Screenshot4.png", caption:"Creating pathways to learning that go far beyond the classroom." },
{ img: "Screenshot5.png", caption:"A digital moment that marked the start of something remarkable." },
{ img: "Screenshot6.png", caption:"The blueprint of an experience designed to change perspectives." },
{ img: "Screenshot7.png", caption:"Documents and details that quietly shaped unforgettable journeys." },
{ img: "Screenshot8.png", caption:"Before the adventure, there was planning; before the story, intention." },
{ img: "Screenshot9.png", caption:"Capturing the early sparks of a global vision coming to life." },
{ img: "Screenshot10.png", caption:"Another piece of the mosaic that built our international journey." },
{ img: "Screenshot11.png", caption:"Moments where the smallest details held the biggest meaning." },
{ img: "Screenshot12.png", caption:"A reminder that every journey is crafted long before it begins." },
{ img: "Screenshot13.png", caption:"Quiet planning, loud impact — the foundation of our travels." },
{ img: "Screenshot14.png", caption:"The behind-the-scenes work that made our global experiences possible." },
{ img: "Screenshot15.png", caption:"Ideas, maps, and dreams all meeting in one digital moment." },
{ img: "Screenshot16.png", caption:"A planning snapshot that would soon turn into lifelong memories." },

{ img: "picA.jpg", caption:"Sunlit smiles reflecting the joy of discovering somewhere new." },
{ img: "picB.jpg", caption:"The simple happiness of sharing experiences far from home." },
{ img: "picC.jpg", caption:"A day when everything felt bright — in colour and in spirit." },

{ img: "picD.jpg", caption:"A captured moment where adventure met serenity." },
{ img: "picE.jpg", caption:"Shared laughter echoing across a new city skyline." },
{ img: "picF.jpg", caption:"The joy of exploring, learning, and simply being present." },
{ img: "picG.jpg", caption:"Friendships strengthened as the world unfolded around us." },
{ img: "picH.jpg", caption:"A warm memory held together by good company and a new place." },
{ img: "picI.jpg", caption:"When the world felt both impossibly big and beautifully close." },
{ img: "picJ.jpg", caption:"A still frame from a day filled with movement and meaning." },
{ img: "picK.jpg", caption:"A picture that reminds us how every trip changes us a little." }
],

/* ============================================================
   OTHER CATEGORIES (unchanged)
============================================================ */

"Sports": [
    {title:"Mayo vs Harvard (Polo Match)", city:"Cambridge (Massachusetts)", country:"USA", lat:42.3736, lng:-71.1097},
    {title:"Abu Dhabi International Sports Festival", city:"Abu Dhabi", country:"UAE", lat:24.4539, lng:54.3773},
    {title:"Golf Tournament — Turkey", city:"Antalya", country:"Turkey", lat:36.8969, lng:30.7133},
    {title:"Golf Tournament — Morocco", city:"Marrakesh", country:"Morocco", lat:31.6295, lng:-7.9811}
],

"Sports Collaboration with Round Square": [
    {title:"Japan Basketball Tour", city:"Hachioji (Tokyo)", country:"Japan", lat:35.6762, lng:139.6503},
    {title:"Bangladesh Cricket Collaboration", city:"Dhakha", country:"Bangladesh", lat:23.8103, lng:90.4125}
],

"Round Square": [
    {title:"Round Square International Conference — Kenya", city:"Nairobi", country:"Kenya", lat:-1.2921, lng:36.8219},
    {title:"Round Square International Conference — Colombia", city:"Bogotá", country:"Colombia", lat:4.7110, lng:-74.0721},
    {title:"Round Square International Service Project — Thailand", city:"Bangkok", country:"Thailand", lat:13.7563, lng:100.5018},
    {title:"The Round Square Forum for South Asia & the Gulf Region", city:"Muscat", country:"Oman", lat:23.5859, lng:58.4059},
    {title:"Round Square Global Conference — Dorset", city:"Dorset", country:"United Kingdom", lat:50.7488, lng:-2.3445},
    {title:"Round Square Global Conference — Shenzhen", city:"Shenzhen", country:"China", lat:22.5431, lng:114.0579},
    {title:"Round Square Global Conference — Tanzania", city:"Arusha", country:"Tanzania", lat:-3.3869, lng:36.6830},
    {title:"Round Square Global Conference — Bangkok", city:"Bangkok", country:"Thailand", lat:13.7563, lng:100.5018},
    {title:"Big Baraza — Oxford", city:"Oxford", country:"United Kingdom", lat:51.75222, lng:-1.25596}
],

"Exchanges": [
    {title:"Australian Exchange — Hale School", city:"Perth", country:"Australia", lat:-31.9523, lng:115.8613},
    {title:"Australian Exchange — Wesley College", city:"Melbourne", country:"Australia", lat:-37.8136, lng:144.9631},
    {title:"UK Exchange — Gresham’s School", city:"Norfolk", country:"United Kingdom", lat:52.6309, lng:1.2974},
    {title:"UK Exchange — Beechwood Primary School", city:"Leeds", country:"United Kingdom", lat:53.8008, lng:-1.5491},
    {title:"UK Exchange — Orwell Park School", city:"Ipswich", country:"United Kingdom", lat:52.0567, lng:1.1482},
    {title:"German Exchange — Schloss Gaeinhoffen", city:"Baden-Württemberg", country:"Germany", lat:48.669, lng:9.350},
    {title:"French Exchange — Lycée Guy Mollet & Sainte Marie de Chavagnes", city:"Arras & Cannes", country:"France", lat:50.293, lng:2.7819},
    {title:"South African Exchange — St John's College", city:"Johannesburg", country:"South Africa", lat:-26.2041, lng:28.0473},
    {title:"Belgian Exchange — Sint-Cordula & Kardinaal Van Roey", city:"Antwerp & Vorselaar", country:"Belgium", lat:51.2194, lng:4.4025}
],

"Insightful Expeditions": [
    {title:"Geography Tour", city:"Las Vegas, Los Angeles and San Francisco", country:"USA", lat:36.1699, lng:-115.1398},
    {title:"Forensic Science Tour", city:"Barcelona, Madrid and San Sebastian", country:"Spain", lat:40.4168, lng:-3.7038},
    {title:"History Tour", city:"Germany, France, Austria, Poland and Belgium", country:"Europe", lat:50.1109, lng:10.0},
    {title:"Post Conference Tour (RSIC)", city:"Amsterdam", country:"Netherlands", lat:52.3676, lng:4.9041}
],

"World Scholar's Cup": [
    {title:"Global Round — Bangkok", city:"Bangkok", country:"Thailand", lat:13.7563, lng:100.5018},
    {title:"Global Round — Seoul", city:"Seoul", country:"South Korea", lat:37.5519, lng:126.9918},
    {title:"Global Round — Doha", city:"Doha", country:"Qatar", lat:25.2854, lng:51.5310},
    {title:"Tournament of Champions — Yale University", city:"New Jersey", country:"USA", lat:41.3163, lng:-72.9223}
],

"Model United Nations": [
    {title:"Model United Nations — United Kingdom", city:"London", country:"United Kingdom", lat:51.5074, lng:-0.1278}
],

"Fests and Camps": [
    {title:"Edinburgh Fringe Festival", city:"Edinburgh", country:"United Kingdom", lat:55.9533, lng:-3.1883},
    {title:"Drukyul Arts & Literature Festival", city:"Thimphu", country:"Bhutan", lat:27.4728, lng:89.6393},
    {title:"German Day — Musaeus College", city:"Colombo", country:"Sri Lanka", lat:6.9271, lng:79.8612},
    {title:"La Fête de la Francophonie — GEMS Modern Academy", city:"Dubai", country:"UAE", lat:25.2048, lng:55.2708},
    {title:"German Youth Camp — Frankfurt", city:"Frankfurt", country:"Germany", lat:50.1109, lng:8.6821}
],

"Drama": [
    {title:"Oliver Twist Immersive- A Theatre and Cultural Tour", city:"London", country:"United Kingdom", lat:51.5074, lng:-0.1278}
],

"Trek": [
    {title:"Everest Base Camp Trek", city:"Everest Base Camp", country:"Nepal", lat:28.0043, lng:86.8571}
]

};

/* ============================================================
   MAP & UI LOGIC (unchanged)
============================================================ */

const PIN_COLOR = {
  "Sports": "red",
  "Sports Collaboration with Round Square": "orange",
  "Round Square": "green",
  "Exchanges": "white",
  "Insightful Expeditions": "blue",
  "World Scholars' Cup": "purple",
  "Model United Nations": "cyan",
  "Fests and Camps": "pink",
  "Drama": "yellow",
  "Trek": "black"
};

const map = L.map("map", {
  minZoom: 2,
  maxZoom: 10,
  zoomControl: true
}).setView([20, 0], 2);

L.tileLayer(
  "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
  {
    attribution: '&copy; CARTO',
    subdomains: "abcd",
    maxZoom: 19
  }
).addTo(map);

map.setMaxBounds([[-85, -180], [85, 180]]);

document.getElementById("resetMap").onclick = () => {
  map.setView([20, 0], 2);
};

const tabBar = document.getElementById("tabBar");
const eventSection = document.getElementById("eventSection");

Object.keys(DATA).forEach((category, index) => {

  const tab = document.createElement("button");
  tab.className = "tab";
  tab.dataset.cat = category;
  tab.textContent = category;
  if (index === 0) tab.classList.add("active");
  tab.onclick = () => activateTab(category);
  tabBar.appendChild(tab);

  const group = document.createElement("div");
  group.className = "group";
  group.id = "group-" + category;
  if (index === 0) group.classList.add("active");

  if (category === "Gallery") group.classList.add("gallery-grid");

  eventSection.appendChild(group);

  DATA[category].forEach((ev, i) => {

    if (category === "Gallery") {
      const item = document.createElement("div");
      item.className = "gallery-item";
      item.style.animationDelay = (i * 0.05) + "s";

      item.innerHTML = `
        <img src="${ev.img}">
        <div class="caption">${ev.caption}</div>
      `;
      group.appendChild(item);
      return;
    }

    const card = document.createElement("div");
    card.className = "event-card";
    card.style.animationDelay = (i * 0.07) + "s";
    card.dataset.lat = ev.lat;
    card.dataset.lng = ev.lng;

    card.innerHTML = `
      <h3>${ev.title}</h3>
      <div class="location">${ev.city}, ${ev.country}</div>
    `;

    card.onclick = () => focusMarker(ev.lat, ev.lng);
    group.appendChild(card);
  });
});

/* MARKERS */
const markers = [];

function createPin(color) {
  const svgMap = {
    red:"#EA4335", orange:"#FB8C00", green:"#34A853",
    white:"#FFFFFF", blue:"#4285F4", purple:"#A142F4",
    cyan:"#00ACC1", pink:"#FF4081", yellow:"#FBC02D",
    black:"#000000"
  };

  const fill = svgMap[color] || "#EA4335";

  return L.divIcon({
    html: `
      <svg width="26" height="42" viewBox="0 0 26 42">
        <path d="M13 0C5.8 0 0 5.8 0 13c0 10.6 13 29 13 29s13-18.4 13-29C26 5.8 20.2 0 13 0z"
              fill="${fill}" stroke="black" stroke-width="2"/>
        <circle cx="13" cy="13" r="6" fill="white" stroke="black" stroke-width="2"/>
      </svg>
    `,
    className: "pin-icon",
    iconSize: [26, 42],
    iconAnchor: [13, 42]
  });
}

Object.keys(DATA).forEach(cat => {
  if (cat === "Gallery") return;

  DATA[cat].forEach(ev => {
    const icon = createPin(PIN_COLOR[cat]);

    const m = L.marker([ev.lat, ev.lng], { icon }).addTo(map);
    m.bindPopup(`<b>${ev.title}</b><br>${ev.city}, ${ev.country}`);

    markers.push({ m, cat, ev });
  });
});

/* TAB SWITCH LOGIC */
function activateTab(cat) {
  document.querySelectorAll(".tab").forEach(t =>
    t.classList.toggle("active", t.dataset.cat === cat)
  );

  document.querySelectorAll(".group").forEach(g =>
    g.classList.remove("active")
  );
  document.getElementById("group-" + cat).classList.add("active");

  if (cat === "Gallery") {
    document.body.classList.add("gallery-open");
  } else {
    document.body.classList.remove("gallery-open");
    map.setView([20,0],2);
    document.getElementById("map").scrollIntoView({ behavior:"smooth" });
  }

  const pts = [];
  markers.forEach(o => {
    if (o.cat === cat) pts.push(o.m.getLatLng());
  });

  if (pts.length === 1) map.setView(pts[0], 6);
  else if (pts.length > 1) map.fitBounds(pts, { padding:[60,60] });
}

/* FOCUS MARKER */
function focusMarker(lat, lng) {
  document.getElementById("map").scrollIntoView({ behavior:"smooth" });
  setTimeout(() => {
    map.setView([lat, lng], 7);
    markers.forEach(o => {
      if (o.ev.lat === lat && o.ev.lng === lng) o.m.openPopup();
    });
  }, 300);
}

/* SEARCH */
const searchInput = document.getElementById("searchInput");
const searchMessage = document.getElementById("searchMessage");

searchInput.addEventListener("keydown", e => {
  if (e.key === "Enter") runSearch();
});

function runSearch() {
  const q = searchInput.value.trim().toLowerCase();
  if (!q) {
    searchMessage.textContent = "Please type something.";
    return;
  }

  let found = false;

  markers.forEach(o => {
    const t = `${o.ev.title} ${o.ev.city} ${o.ev.country}`.toLowerCase();
    if (t.includes(q)) {
      found = true;
      focusMarker(o.ev.lat, o.ev.lng);
    }
  });

  searchMessage.textContent = found ? "" : "No matching result found.";
}

/* FILTER MODAL */
const filterModal = document.getElementById("filterModal");

document.getElementById("filterBtn").onclick = () =>
  filterModal.style.display = "flex";
document.getElementById("closeFilter").onclick = () =>
  filterModal.style.display = "none";

const filterList = document.getElementById("filterList");

Object.keys(DATA).forEach(cat => {
  const label = document.createElement("label");
  label.style.display = "block";
  label.style.color = "var(--text)";
  label.style.marginBottom = "10px";
  label.innerHTML =
    `<input type="checkbox" data-cat="${cat}" checked> ${cat}`;
  filterList.appendChild(label);
});

document.getElementById("applyFilters").onclick = () => {
  document.querySelectorAll("#filterList input").forEach(cb => {
    toggleCategory(cb.dataset.cat, cb.checked);
  });
  filterModal.style.display = "none";
};

document.getElementById("resetFilters").onclick = () => {
  document.querySelectorAll("#filterList input").forEach(cb => {
    cb.checked = true;
    toggleCategory(cb.dataset.cat, true);
  });
};

function toggleCategory(cat, show) {
  markers.forEach(o => {
    if (o.cat === cat) {
      if (show) map.addLayer(o.m);
      else map.removeLayer(o.m);
    }
  });
}

/* LIGHTBOX */
const lightbox = document.getElementById("lightbox");
const lightboxImg = document.getElementById("lightbox-img");

document.addEventListener("click", e => {
  const item = e.target.closest(".gallery-item");
  if (!item) return;
  lightboxImg.src = item.querySelector("img").src;
  lightbox.style.display = "flex";
});

document.getElementById("lightbox-close").onclick = () =>
  lightbox.style.display = "none";

/* SERVICE WORKER */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}

</script>

</body>
</html>
